> [!WARNING]
> You have reached your daily quota limit. Please wait up to 24 hours and I will start processing your requests again!
/gemini review
@coderabbitai review
/review
@sourcery-ai review
@ellipsis review this
<!-- Generated by sourcery-ai[bot]: start review_guide -->

## Reviewer's Guide

Fixes two back-navigation crashes by making CustomTabs service binding lifecycle-safe and adjusting fragment lifecycle cleanup order, plus minor formatting and Javadoc tweaks.

#### Sequence diagram for CustomTabsDelegate bind/unbind lifecycle-safe behavior

```mermaid
sequenceDiagram
    actor User
    participant Activity
    participant ApplicationContext
    participant CustomTabsDelegate
    participant CustomTabsService

    User->>Activity: open link
    Activity->>CustomTabsDelegate: bindCustomTabsService(activity)
    CustomTabsDelegate->>CustomTabsDelegate: check mClient and mBound
    alt not already bound and package available
        Activity->>ApplicationContext: getApplicationContext()
        ApplicationContext->>CustomTabsService: bindCustomTabsService(pkg, connection)
        CustomTabsService-->>ApplicationContext: returns boolean bound
        ApplicationContext-->>CustomTabsDelegate: bound result
        CustomTabsDelegate->>CustomTabsDelegate: set mBound = true
        CustomTabsService-->>CustomTabsDelegate: onServiceConnected
        CustomTabsDelegate->>CustomTabsDelegate: set mClient, mCustomTabsSession
    else already bound or no package
        CustomTabsDelegate->>CustomTabsDelegate: return without binding
    end

    User->>Activity: navigate back
    Activity->>CustomTabsDelegate: unbindCustomTabsService(activity)
    CustomTabsDelegate->>CustomTabsDelegate: check mConnection and mBound
    alt connection exists and mBound is true
        Activity->>ApplicationContext: getApplicationContext()
        ApplicationContext->>ApplicationContext: try unbindService(mConnection)
        ApplicationContext-->>CustomTabsDelegate: may throw IllegalArgumentException
        CustomTabsDelegate->>CustomTabsDelegate: catch and ignore exception
        CustomTabsDelegate->>CustomTabsDelegate: set mClient = null
        CustomTabsDelegate->>CustomTabsDelegate: set mCustomTabsSession = null
        CustomTabsDelegate->>CustomTabsDelegate: set mConnection = null
        CustomTabsDelegate->>CustomTabsDelegate: set mBound = false
    else not bound
        CustomTabsDelegate->>CustomTabsDelegate: return without unbinding
    end
```

#### Class diagram for CustomTabsDelegate and fragment lifecycle changes

```mermaid
classDiagram
    class CustomTabsDelegate {
        - String ACTION_CUSTOM_TABS_CONNECTION
        - CustomTabsSession mCustomTabsSession
        - CustomTabsClient mClient
        - CustomTabsServiceConnection mConnection
        - boolean mBound
        + void bindCustomTabsService(Activity activity)
        + void unbindCustomTabsService(Activity activity)
        + boolean mayLaunchUrl(Uri uri, Bundle extras, List otherLikelyBundles)
        + CustomTabsSession getSession()
        + String getPackageNameToUse(Context context)
    }

    class BaseFragment {
        - boolean mAttached
        + void onCreate(Bundle savedInstanceState)
        + void onActivityCreated(Bundle savedInstanceState)
        + void onCreateOptionsMenu(Menu menu, MenuInflater inflater)
        + void onPrepareOptionsMenu(Menu menu)
        + void onDetach()
        + boolean isAttached()
        ..lifecycle change..
        + void onDetach() mAttached = false then super.onDetach()
    }

    class BaseListFragment {
        <<abstract>>
        - static String STATE_ADAPTER
        - CustomTabsDelegate mCustomTabsDelegate
        - KeyDelegate_RecyclerViewHelper mScrollableHelper
        - RecyclerView mRecyclerView
        - Preferences_Observable mPreferenceObservable
        + void onCreate(Bundle savedInstanceState)
        + void onViewCreated(View view, Bundle savedInstanceState)
        + void onActivityCreated(Bundle savedInstanceState)
        + void onSaveInstanceState(Bundle outState)
        + void onDetach()
        + void scrollToTop()
        + ItemRecyclerViewAdapter getAdapter()
        ..lifecycle change..
        + void onDetach() unsubscribe, mRecyclerView.setAdapter(null), super.onDetach()
    }

    class ItemFragment {
        - View mFragmentView
        - View mEmptyView
        - Item mItem
        - String mItemId
        - ItemManager mItemManager
        - SwipeRefreshLayout mSwipeRefreshLayout
        - SinglePageItemRecyclerViewAdapter_SavedState mAdapterItems
        - ItemRecyclerViewAdapter mAdapter
        - Preferences_Observable mPreferenceObservable
        + void onCreate(Bundle savedInstanceState)
        + View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)
        + void onActivityCreated(Bundle savedInstanceState)
        + void onDestroy()
        + void onDetach()
        ..lifecycle change..
        + void onDetach() unsubscribe(getActivity()), super.onDetach()
    }

    class FavoriteFragment {
        - ActionMode mActionMode
        - String mFilter
        - boolean mSearchViewExpanded
        - FavoriteManager mFavoriteManager
        - ActionViewResolver mActionViewResolver
        - AlertDialogBuilder mAlertDialogBuilder
        - View mEmptySearchView
        - View mEmptyView
        + void onCreate(Bundle savedInstanceState)
        + View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)
        + void onStart()
        + void onStop()
        + void onDetach()
        ..lifecycle change..
        + void onDetach() finish mActionMode, super.onDetach()
    }

    class WebFragment {
        - String EXTRA_ITEM
        - String STATE_EMPTY
        - String STATE_READABILITY
        - String ACTION_FULLSCREEN
        - String EXTRA_FULLSCREEN
        - int DEFAULT_PROGRESS
        - String PDF_LOADER_URL
        - String PDF_MIME_TYPE
        - WebView mWebView
        - NestedScrollView mScrollView
        - boolean mExternalRequired
        - ItemManager mItemManager
        - PopupMenu mPopupMenu
        - KeyDelegate_NestedScrollViewHelper mScrollableHelper
        - Preferences_Observable mPreferenceObservable
        - BroadcastReceiver mReceiver
        - ViewGroup mFullscreenView
        - ViewGroup mScrollViewContent
        - ImageButton mButtonRefresh
        - ViewSwitcher mControls
        - EditText mEditText
        - View mButtonMore
        - ProgressBar mProgressBar
        - String mContent
        - AppUtils_SystemUiHelper mSystemUiHelper
        - View mFragmentView
        - ReadabilityClient mReadabilityClient
        - FileDownloader mFileDownloader
        - WebItem mItem
        - boolean mIsHackerNewsUrl
        - boolean mEmpty
        - boolean mReadability
        - PdfAndroidJavascriptBridge mPdfAndroidJavascriptBridge
        + void onCreate(Bundle savedInstanceState)
        + View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)
        + void onDestroy()
        + void onDetach()
        ..lifecycle change..
        + void onDetach() unsubscribe and unregister using getActivity(), super.onDetach()
    }

    BaseListFragment --|> BaseFragment
    ItemFragment --|> LazyLoadFragment
    WebFragment --|> LazyLoadFragment
    FavoriteFragment --|> BaseListFragment
    BaseListFragment --> CustomTabsDelegate
    ItemFragment --> Preferences_Observable
    WebFragment --> Preferences_Observable
    BaseListFragment --> Preferences_Observable

    class Preferences_Observable {
        + void subscribe(Context context)
        + void unsubscribe(Context context)
    }

    class KeyDelegate_RecyclerViewHelper
    class KeyDelegate_NestedScrollViewHelper
    class SinglePageItemRecyclerViewAdapter_SavedState
    class AppUtils_SystemUiHelper
    class FavoriteManager
    class ActionViewResolver
    class AlertDialogBuilder
    class ReadabilityClient
    class FileDownloader
    class ItemManager
    class WebItem
    class Item
    class ItemRecyclerViewAdapter
    class LazyLoadFragment
```

### File-Level Changes

| Change | Details | Files |
| ------ | ------- | ----- |
| Make CustomTabsDelegate service binding/unbinding lifecycle-safe to prevent IllegalArgumentException when navigating back. | <ul><li>Track service binding state with a mBound flag and short-circuit bind/unbind when inappropriate.</li><li>Use application context instead of the Activity instance for Custom Tabs service bind/unbind calls.</li><li>Guard unbindService in a try-catch to swallow IllegalArgumentException from redundant/unmatched unbinds.</li><li>Tighten early-return conditions when a client is already connected or binding has already occurred.</li></ul> | `app/src/main/java/io/github/hidroh/materialistic/CustomTabsDelegate.java` |
| Reorder fragment onDetach() cleanup to run before calling super to avoid getActivity() returning null during teardown. | <ul><li>Move super.onDetach() to the end of onDetach() implementations so cleanup using getActivity() runs while the fragment is still attached.</li><li>Ensure preference observable unsubscription, broadcast receiver unregister, RecyclerView adapter detach, and ActionMode finish happen before super.onDetach().</li></ul> | `app/src/main/java/io/github/hidroh/materialistic/BaseFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/BaseListFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/ItemFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/FavoriteFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/WebFragment.java` |
| Apply minor style and formatting cleanups for readability and consistency. | <ul><li>Normalize annotation placement and field declarations to one-per-line style.</li><li>Rewrap long method signatures, Javadocs, and chained calls to follow project formatting conventions.</li><li>Apply small code style tweaks such as spacing around casts and comments.</li></ul> | `app/src/main/java/io/github/hidroh/materialistic/WebFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/FavoriteFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/ItemFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/BaseListFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/BaseFragment.java`<br/>`app/src/main/java/io/github/hidroh/materialistic/CustomTabsDelegate.java` |

---

<details>
<summary>Tips and commands</summary>

#### Interacting with Sourcery

- **Trigger a new review:** Comment `@sourcery-ai review` on the pull request.
- **Continue discussions:** Reply directly to Sourcery's review comments.
- **Generate a GitHub issue from a review comment:** Ask Sourcery to create an
  issue from a review comment by replying to it. You can also reply to a
  review comment with `@sourcery-ai issue` to create an issue from it.
- **Generate a pull request title:** Write `@sourcery-ai` anywhere in the pull
  request title to generate a title at any time. You can also comment
  `@sourcery-ai title` on the pull request to (re-)generate the title at any time.
- **Generate a pull request summary:** Write `@sourcery-ai summary` anywhere in
  the pull request body to generate a PR summary at any time exactly where you
  want it. You can also comment `@sourcery-ai summary` on the pull request to
  (re-)generate the summary at any time.
- **Generate reviewer's guide:** Comment `@sourcery-ai guide` on the pull
  request to (re-)generate the reviewer's guide at any time.
- **Resolve all Sourcery comments:** Comment `@sourcery-ai resolve` on the
  pull request to resolve all Sourcery comments. Useful if you've already
  addressed all the comments and don't want to see them anymore.
- **Dismiss all Sourcery reviews:** Comment `@sourcery-ai dismiss` on the pull
  request to dismiss all existing Sourcery reviews. Especially useful if you
  want to start fresh with a new review - don't forget to comment
  `@sourcery-ai review` to trigger a new review!

#### Customizing Your Experience

Access your [dashboard](https://app.sourcery.ai) to:
- Enable or disable review features such as the Sourcery-generated pull request
  summary, the reviewer's guide, and others.
- Change the review language.
- Add, remove or edit custom review instructions.
- Adjust other review settings.

#### Getting Help

- [Contact our support team](mailto:support@sourcery.ai) for questions or feedback.
- Visit our [documentation](https://docs.sourcery.ai) for detailed guides and information.
- Keep in touch with the Sourcery team by following us on [X/Twitter](https://x.com/SourceryAI), [LinkedIn](https://www.linkedin.com/company/sourcery-ai/) or [GitHub](https://github.com/sourcery-ai).

</details>

<!-- Generated by sourcery-ai[bot]: end review_guide -->
> [!WARNING]
> You have reached your daily quota limit. Please wait up to 24 hours and I will start processing your requests again!
<!-- This is an auto-generated comment: summarize by coderabbit.ai -->
<!-- This is an auto-generated comment: review in progress by coderabbit.ai -->

> [!NOTE]
> Currently processing new changes in this PR. This may take a few minutes, please wait...
> 
> <details>
> <summary>üì• Commits</summary>
> 
> Reviewing files that changed from the base of the PR and between 70a45d9becc9f60c2b31f8cf2ad0d763e1af0912 and d12f1227c1cb7383b76c575b6f71a6383cc97d64.
> 
> </details>
> 
> <details>
> <summary>üìí Files selected for processing (6)</summary>
> 
> * `app/src/main/java/io/github/hidroh/materialistic/BaseFragment.java`
> * `app/src/main/java/io/github/hidroh/materialistic/BaseListFragment.java`
> * `app/src/main/java/io/github/hidroh/materialistic/CustomTabsDelegate.java`
> * `app/src/main/java/io/github/hidroh/materialistic/FavoriteFragment.java`
> * `app/src/main/java/io/github/hidroh/materialistic/ItemFragment.java`
> * `app/src/main/java/io/github/hidroh/materialistic/WebFragment.java`
> 
> </details>
> 
> ```ascii
>  _____________________________________
> < I don‚Äôt chase bugs; they surrender. >
>  -------------------------------------
>   \
>    \   \
>         \ /\
>         ( )
>       .( o ).
> ```
> 
> <sub>‚úèÔ∏è Tip: You can disable in-progress messages by setting `review_status` to `false` in your review settings. Additionally, you can disable the fortune message by setting `in_progress_fortune` to `false` in your review settings.</sub>

<!-- end of auto-generated comment: review in progress by coderabbit.ai -->


<!-- finishing_touch_checkbox_start -->

<details>
<summary>‚ú® Finishing touches</summary>

- [ ] <!-- {"checkboxId": "7962f53c-55bc-4827-bfbf-6a18da830691"} --> üìù Generate docstrings

</details>

<!-- finishing_touch_checkbox_end -->

<!-- tips_start -->

---

Thanks for using [CodeRabbit](https://coderabbit.ai?utm_source=oss&utm_medium=github&utm_campaign=sheepdestroyer/materialistic&utm_content=43)! It's free for OSS, and your support helps us grow. If you like it, consider giving us a shout-out.

<details>
<summary>‚ù§Ô∏è Share</summary>

- [X](https://twitter.com/intent/tweet?text=I%20just%20used%20%40coderabbitai%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20the%20proprietary%20code.%20Check%20it%20out%3A&url=https%3A//coderabbit.ai)
- [Mastodon](https://mastodon.social/share?text=I%20just%20used%20%40coderabbitai%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20the%20proprietary%20code.%20Check%20it%20out%3A%20https%3A%2F%2Fcoderabbit.ai)
- [Reddit](https://www.reddit.com/submit?title=Great%20tool%20for%20code%20review%20-%20CodeRabbit&text=I%20just%20used%20CodeRabbit%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20proprietary%20code.%20Check%20it%20out%3A%20https%3A//coderabbit.ai)
- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcoderabbit.ai&mini=true&title=Great%20tool%20for%20code%20review%20-%20CodeRabbit&summary=I%20just%20used%20CodeRabbit%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20proprietary%20code)

</details>

<sub>Comment `@coderabbitai help` to get the list of available commands and usage tips.</sub>

<!-- tips_end -->
<!-- This is an auto-generated reply by CodeRabbit -->
`@sheepdestroyer`: I'll review the changes in this PR right away!

<details>
<summary>‚úÖ Actions performed</summary>

Review triggered.

> Note: CodeRabbit is an incremental review system and does not re-review already reviewed commits. This command is applicable only when automatic reviews are paused.

</details>
## PR Compliance Guide üîç


<!-- https://github.com/sheepdestroyer/materialistic/commit/d12f1227c1cb7383b76c575b6f71a6383cc97d64 -->
Below is a summary of compliance checks for this PR:<br>
<table><tbody><tr><td colspan='2'><strong>Security Compliance</strong></td></tr>
<tr><td>üü¢</td><td><details><summary><strong>No security concerns identified</strong></summary>
No security vulnerabilities detected by AI analysis. Human verification advised for critical code.
</details></td></tr>
<tr><td colspan='2'><strong>Ticket Compliance</strong></td></tr>
<tr><td>‚ö™</td><td><details><summary>üé´ <strong>No ticket provided </strong></summary>


- [ ] Create ticket/issue <!-- /create_ticket --create_ticket=true -->

</details></td></tr>
<tr><td colspan='2'><strong>Codebase Duplication Compliance</strong></td></tr>
<tr><td>‚ö™</td><td><details><summary><strong>Codebase context is not defined </strong></summary>


Follow the <a href='https://qodo-merge-docs.qodo.ai/core-abilities/rag_context_enrichment/'>guide</a> to enable codebase context checks.

</details></td></tr>
<tr><td colspan='2'><strong>Custom Compliance</strong></td></tr>
<tr><td rowspan=4>üü¢</td><td>
<details><summary><strong>Generic: Comprehensive Audit Trails</strong></summary><br>

**Objective:** To create a detailed and reliable record of critical system actions for security analysis <br>and compliance.<br>

**Status:** Passed<br>


> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>
</details></td></tr>
<tr><td>
<details><summary><strong>Generic: Secure Error Handling</strong></summary><br>

**Objective:** To prevent the leakage of sensitive system information through error messages while <br>providing sufficient detail for internal debugging.<br>

**Status:** Passed<br>


> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>
</details></td></tr>
<tr><td>
<details><summary><strong>Generic: Secure Logging Practices</strong></summary><br>

**Objective:** To ensure logs are useful for debugging and auditing without exposing sensitive <br>information like PII, PHI, or cardholder data.<br>

**Status:** Passed<br>


> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>
</details></td></tr>
<tr><td>
<details><summary><strong>Generic: Security-First Input Validation and Data Handling</strong></summary><br>

**Objective:** Ensure all data inputs are validated, sanitized, and handled securely to prevent <br>vulnerabilities<br>

**Status:** Passed<br>


> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>
</details></td></tr>
<tr><td rowspan=1>üî¥</td>
<td><details>
<summary><strong>Generic: Robust Error Handling and Edge Case Management</strong></summary><br>

**Objective:** Ensure comprehensive error handling that provides meaningful context and graceful <br>degradation<br>

**Status:** <br><a href='https://github.com/sheepdestroyer/materialistic/pull/43/files#diff-ccbc9c613815b7fe56367db63b7143e1706e20bc9c58b007f68602c532f4d8a8R75-R83'><strong>Swallowed exception</strong></a>: <code>IllegalArgumentException</code> from <code>unbindService</code> is caught and silently ignored without logging <br>or actionable context, hindering debugging and incident reconstruction.<br>
<details open><summary>Referred Code</summary>

```java
void unbindCustomTabsService(Activity activity) {
    if (mConnection == null || !mBound) {
        return;
    }
    try {
        activity.getApplicationContext().unbindService(mConnection);
    } catch (IllegalArgumentException e) {
        // ignore
    }
```

</details>

> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>
</details></td></tr>
<tr><td rowspan=1>‚ö™</td>
<td><details>
<summary><strong>Generic: Meaningful Naming and Self-Documenting Code</strong></summary><br>

**Objective:** Ensure all identifiers clearly express their purpose and intent, making code <br>self-documenting<br>

**Status:** <br><a href='https://github.com/sheepdestroyer/materialistic/pull/43/files#diff-ccbc9c613815b7fe56367db63b7143e1706e20bc9c58b007f68602c532f4d8a8R51-R51'><strong>Boolean naming convention</strong></a>: The new boolean flag <code>mBound</code> does not follow the checklist‚Äôs preferred boolean naming style <br>(e.g., <code>isBound</code>/<code>hasBound</code>) and may reduce self-documentation depending on project <br>conventions.<br>
<details open><summary>Referred Code</summary>

```java
private boolean mBound;

```

</details>

> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>
</details></td></tr>

<tr><td align="center" colspan="2">

<!-- placeholder --> <!-- /compliance --update_compliance=true -->

</td></tr></tbody></table>
<details><summary>Compliance status legend</summary>
üü¢ - Fully Compliant<br>
üü° - Partial Compliant<br>
üî¥ - Not Compliant<br>
‚ö™ - Requires Further Human Verification<br>
üè∑Ô∏è - Compliance label<br>
</details>

Hey - I've reviewed your changes and they look great!

***

<details>
<summary>Sourcery is free for open source - if you like our reviews please consider sharing them ‚ú®</summary>

- [X](https://twitter.com/intent/tweet?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)
- [Mastodon](https://mastodon.social/share?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)
- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https://sourcery.ai)
- [Facebook](https://www.facebook.com/sharer/sharer.php?u=https://sourcery.ai)

</details>

<sub>
Help me be more useful! Please click üëç or üëé on each comment and I'll use the feedback to improve your reviews.
</sub>
