[{"author":{"login":"sourcery-ai"},"authorAssociation":"NONE","body":"Hey - I've found 4 issues, and left some high level feedback:\n\n- In `ItemActivity.bindData` the `ViewPager2` adapter and `setOffscreenPageLimit(2)` calls are duplicated; this can be consolidated to a single adapter assignment and configuration block.\n- Helper/log files like `cycle2_feedback.txt`, `feedback_log.txt`, and `my_build_log*.txt` look like local artifacts and probably shouldn't be committed to the repo.\n- The fragment lookup logic using hard-coded tags (`\"f\" + itemId`) is duplicated in multiple places; consider centralizing this in the adapter (or a shared helper) so future changes to `getItemId()` or tag format only need to be updated in one place.\n\n\u003cdetails\u003e\n\u003csummary\u003ePrompt for AI Agents\u003c/summary\u003e\n\n~~~markdown\nPlease address the comments from this code review:\n\n## Overall Comments\n- In `ItemActivity.bindData` the `ViewPager2` adapter and `setOffscreenPageLimit(2)` calls are duplicated; this can be consolidated to a single adapter assignment and configuration block.\n- Helper/log files like `cycle2_feedback.txt`, `feedback_log.txt`, and `my_build_log*.txt` look like local artifacts and probably shouldn't be committed to the repo.\n- The fragment lookup logic using hard-coded tags (`\"f\" + itemId`) is duplicated in multiple places; consider centralizing this in the adapter (or a shared helper) so future changes to `getItemId()` or tag format only need to be updated in one place.\n\n## Individual Comments\n\n### Comment 1\n\u003clocation\u003e `app/src/main/java/io/github/sheepdestroyer/materialisheep/ItemActivity.java:522-523` \u003c/location\u003e\n\u003ccode_context\u003e\n                 .setShowArticle(true)\n                 .setDefaultViewMode(mStoryViewMode));\n-        mAdapter.bind(mViewPager, mTabLayout, mNavButton, mReplyButton);\n+        mViewPager.setAdapter(mAdapter);\n+        mTabLayoutMediator = new TabLayoutMediator(mTabLayout, mViewPager,\n+                (tab, position) -\u003e tab.setText(mAdapter.getPageTitle(position)));\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**issue:** ViewPager2 adapter and offscreen page limit are set twice in a row.\n\nIn `bindData`, `mViewPager.setAdapter(mAdapter);` and `mViewPager.setOffscreenPageLimit(2);` are each invoked twice in succession. The second set of calls is redundant and should be removed to reduce noise and avoid confusion.\n\u003c/issue_to_address\u003e\n\n### Comment 2\n\u003clocation\u003e `app/src/main/java/io/github/sheepdestroyer/materialisheep/widget/ItemPagerAdapter.java:60-61` \u003c/location\u003e\n\u003ccode_context\u003e\n+        mContext = fragmentActivity;\n         mItem = builder.item;\n         mShowArticle = builder.showArticle;\n         mCacheMode = builder.cacheMode;\n         mRetainInstance = builder.retainInstance;\n-        mDefaultItem = Math.min(getCount() - 1,\n+        mDefaultItem = Math.min(getItemCount() - 1,\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**suggestion:** The retainInstance configuration is still stored but appears unused after the migration.\n\n`mRetainInstance` is still set from `builder.retainInstance` but never used, and `LazyLoadFragment` no longer relies on `EXTRA_RETAIN_INSTANCE`. Consider removing `retainInstance` from both the `Builder` and adapter to avoid a misleading, unused API option.\n\nSuggested implementation:\n\n```java\n        mItem = builder.item;\n        mShowArticle = builder.showArticle;\n        mCacheMode = builder.cacheMode;\n        mDefaultItem = Math.min(getItemCount() - 1,\n                builder.defaultViewMode == Preferences.StoryViewMode.Comment ? 0 : 1);\n\n```\n\nIn order to fully remove the misleading `retainInstance` option as suggested, you should also:\n1. Remove the `mRetainInstance` field declaration from `ItemPagerAdapter` (e.g., `private boolean mRetainInstance;` if present).\n2. Remove the `retainInstance` field from the `Builder` inner class (e.g., `boolean retainInstance;` or `private boolean retainInstance;`).\n3. Remove any builder methods that configure this flag (e.g., `Builder retainInstance(boolean)` / `setRetainInstance(boolean)`).\n4. Remove any remaining usages of `retainInstance` or `mRetainInstance` in this file and elsewhere in the codebase, ensuring no references remain to the removed API.\n\u003c/issue_to_address\u003e\n\n### Comment 3\n\u003clocation\u003e `cycle5_feedback.txt:2214` \u003c/location\u003e\n\u003ccode_context\u003e\n-     *                 menu.\n+     * Called immediately after\n+     * {@link #onCreateView(LayoutInflater, ViewGroup, Bundle)}\n+     * has returned, but before any saved state has been restored in to the view.\n      */\n-    @SuppressWarnings(\"deprecation\") // Using deprecated Fragment menu API; migration to MenuProvider requires\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**nitpick (typo):** Minor grammar: use \"into\" instead of \"in to\" in this sentence.\n\nIn this Javadoc sentence, \"restored into the view\" reads more naturally and is grammatically correct compared to \"restored in to the view.\"\n\u003c/issue_to_address\u003e\n\n### Comment 4\n\u003clocation\u003e `cycle4_feedback.txt:2182` \u003c/location\u003e\n\u003ccode_context\u003e\n-     *                 menu.\n+     * Called immediately after\n+     * {@link #onCreateView(LayoutInflater, ViewGroup, Bundle)}\n+     * has returned, but before any saved state has been restored in to the view.\n      */\n-    @SuppressWarnings(\"deprecation\") // Using deprecated Fragment menu API; migration to MenuProvider requires\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**nitpick (typo):** Minor grammar fix: \"restored into the view\" reads better than \"restored in to the view\".\n\nConsider rephrasing this Javadoc line to: \"has returned, but before any saved state has been restored into the view.\" The main change is \"in to\" ‚Üí \"into\" for smoother, more natural wording.\n\u003c/issue_to_address\u003e\n~~~\n\n\u003c/details\u003e\n\n***\n\n\u003cdetails\u003e\n\u003csummary\u003eSourcery is free for open source - if you like our reviews please consider sharing them ‚ú®\u003c/summary\u003e\n\n- [X](https://twitter.com/intent/tweet?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [Mastodon](https://mastodon.social/share?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https://sourcery.ai)\n- [Facebook](https://www.facebook.com/sharer/sharer.php?u=https://sourcery.ai)\n\n\u003c/details\u003e\n\n\u003csub\u003e\nHelp me be more useful! Please click üëç or üëé on each comment and I'll use the feedback to improve your reviews.\n\u003c/sub\u003e","commit":{"oid":"2b7590d7c0a14a490006301d0ee4b8185234d743"},"id":"PRR_kwDOQBDOvc7bG4eu","includesCreatedEdit":false,"reactionGroups":[],"state":"COMMENTED","submittedAt":"2026-01-19T02:01:51Z"},{"author":{"login":"gemini-code-assist"},"authorAssociation":"NONE","body":"## Code Review\n\nThis is an excellent pull request that modernizes a significant part of the Android application. The migration from ViewPager to ViewPager2, along with the adoption of modern Fragment APIs like MenuProvider and ViewModel for state retention, is well-executed and greatly improves the codebase's maintainability and adherence to current best practices. The refactoring is clean and thorough. I've found only one minor issue regarding code duplication, which is a small fix. Great job on this refactor!","commit":{"oid":"2b7590d7c0a14a490006301d0ee4b8185234d743"},"id":"PRR_kwDOQBDOvc7bG4mB","includesCreatedEdit":false,"reactionGroups":[],"state":"COMMENTED","submittedAt":"2026-01-19T02:02:17Z"},{"author":{"login":"ellipsis-dev"},"authorAssociation":"NONE","body":"\u003e [!IMPORTANT]\n\u003e **Looks good to me!  :+1:**\n\u003e \u003cdetails\u003e\n\u003e \u003csummary\u003eReviewed 33c516489344a4e81a3b428985825ceb5244ac96 in \u003cellipsistime\u003e1 minute and 20 seconds\u003c/ellipsistime\u003e. Click for details.\u003c/summary\u003e \n\u003e \n\u003e - Reviewed `85` lines of code in `2` files\n\u003e - Skipped `0` files when reviewing.\n\u003e - Skipped posting `4` draft comments. View those below.\n\u003e - Modify your [settings](https://app.ellipsis.dev/sheepdestroyer/settings/code-review) and [rules](https://app.ellipsis.dev/sheepdestroyer/code-review/rules) to customize what types of comments Ellipsis leaves. And don't forget to react with :+1: or :-1: to teach Ellipsis.\n\u003e \n\u003e \u003cdetails\u003e\n\u003e \u003csummary\u003e1. \u003ccode\u003eapp/src/main/java/io/github/sheepdestroyer/materialisheep/BaseListActivity.java:469\u003c/code\u003e\u003c/summary\u003e\n\u003e \n\u003e - **Draft comment:** \n\u003e Good Javadoc for setFullscreen(); consider explicitly mentioning that it also updates the ViewPager2 user input state.\n\u003e - **Reason this comment was not posted:**\n\u003e Confidence changes required: `0%` \u003c= threshold `50%` None\n\u003e \n\u003e \n\u003e \u003c/details\u003e\n\u003e \n\u003e \u003cdetails\u003e\n\u003e \u003csummary\u003e2. \u003ccode\u003eapp/src/main/java/io/github/sheepdestroyer/materialisheep/ItemActivity.java:526\u003c/code\u003e\u003c/summary\u003e\n\u003e \n\u003e - **Draft comment:** \n\u003e Avoid using setRetainInstance(true) in the adapter builder. Since the PR‚Äôs goal is to replace deprecated retention with LazyLoadViewModel, remove or refactor this flag.\n\u003e - **Reason this comment was not posted:**\n\u003e Comment was not on a location in the diff, so it can't be submitted as a review comment.\n\u003e \n\u003e \n\u003e \u003c/details\u003e\n\u003e \n\u003e \u003cdetails\u003e\n\u003e \u003csummary\u003e3. \u003ccode\u003eapp/src/main/java/io/github/sheepdestroyer/materialisheep/ItemActivity.java:528\u003c/code\u003e\u003c/summary\u003e\n\u003e \n\u003e - **Draft comment:** \n\u003e Redundant calls to setAdapter() and setOffscreenPageLimit() on mViewPager in bindData(); consolidate to a single call each.\n\u003e - **Reason this comment was not posted:**\n\u003e Comment was not on a location in the diff, so it can't be submitted as a review comment.\n\u003e \n\u003e \n\u003e \u003c/details\u003e\n\u003e \n\u003e \u003cdetails\u003e\n\u003e \u003csummary\u003e4. \u003ccode\u003eapp/src/main/java/io/github/sheepdestroyer/materialisheep/ItemActivity.java:605\u003c/code\u003e\u003c/summary\u003e\n\u003e \n\u003e - **Draft comment:** \n\u003e Verify that getFragment() uses a tag consistent with the FragmentStateAdapter‚Äôs tag format ('f' + itemId).\n\u003e - **Reason this comment was not posted:**\n\u003e Confidence changes required: `33%` \u003c= threshold `50%` None\n\u003e \n\u003e \n\u003e \u003c/details\u003e\n\u003e \n\u003e \n\u003e Workflow ID: \u003cworkflowid\u003e`wflow_FOWGmRahlcuGpBUS`\u003c/workflowid\u003e\n\u003e \u003c/details\u003e\n\u003e \n\u003e \u003csup\u003eYou can customize \u003c/sup\u003e[\u003cimg alt=\"Ellipsis\" src=\"https://img.shields.io/badge/Ellipsis-blue?color=175173\"\u003e](https://www.ellipsis.dev?ref=sheepdestroyer%2Fmaterialisheep\u0026utm_source=github\u0026utm_medium=referral)\u003csup\u003e by changing your [verbosity settings](https://app.ellipsis.dev/sheepdestroyer/settings/code-review), reacting with :+1: or :-1:, [replying to comments](https://docs.ellipsis.dev/features/code-review#teaching-ellipsis), or adding [code review rules](https://app.ellipsis.dev/sheepdestroyer/code-review/rules).\u003c/sup\u003e","commit":{"oid":"33c516489344a4e81a3b428985825ceb5244ac96"},"id":"PRR_kwDOQBDOvc7bG5DJ","includesCreatedEdit":false,"reactionGroups":[],"state":"COMMENTED","submittedAt":"2026-01-19T02:03:52Z"},{"author":{"login":"gemini-code-assist"},"authorAssociation":"NONE","body":"## Code Review\n\nThis is an excellent pull request that successfully migrates the application from the deprecated `ViewPager` and `FragmentStatePagerAdapter` to the modern `ViewPager2` and `FragmentStateAdapter`. The modernization of Fragment APIs, such as replacing `onActivityCreated` with `onViewCreated` and using `ViewModel` for state retention instead of `setRetainInstance`, is well-executed and improves the overall architecture. I've found a couple of issues that should be addressed, one of which is a clear redundancy and another a potentially risky use of an API.","commit":{"oid":"33c516489344a4e81a3b428985825ceb5244ac96"},"id":"PRR_kwDOQBDOvc7bG5f8","includesCreatedEdit":false,"reactionGroups":[],"state":"COMMENTED","submittedAt":"2026-01-19T02:05:38Z"},{"author":{"login":"sourcery-ai"},"authorAssociation":"NONE","body":"Hey - I've found 4 issues, and left some high level feedback:\n\n- In ItemActivity.bindData you call setAdapter and setOffscreenPageLimit on the ViewPager2 twice in a row; you can remove the duplicate calls to keep setup clearer and avoid confusion about intended configuration.\n- The retain-instance path has effectively been removed (LazyLoadFragment no longer reads EXTRA_RETAIN_INSTANCE), but ItemPagerAdapter.Builder still exposes retainInstance and the field is stored but unused; consider removing this parameter/field to avoid dead configuration options.\n- Both ItemActivity and BaseListActivity rely on hardcoded ViewPager2 fragment tags (\"f\" + itemId) for getFragment/unbind logic; it may be safer to centralize this tag construction (or encapsulate fragment lookup) in ItemPagerAdapter so future changes to getItemId or adapter behavior don't silently break these lookups.\n\n\u003cdetails\u003e\n\u003csummary\u003ePrompt for AI Agents\u003c/summary\u003e\n\n~~~markdown\nPlease address the comments from this code review:\n\n## Overall Comments\n- In ItemActivity.bindData you call setAdapter and setOffscreenPageLimit on the ViewPager2 twice in a row; you can remove the duplicate calls to keep setup clearer and avoid confusion about intended configuration.\n- The retain-instance path has effectively been removed (LazyLoadFragment no longer reads EXTRA_RETAIN_INSTANCE), but ItemPagerAdapter.Builder still exposes retainInstance and the field is stored but unused; consider removing this parameter/field to avoid dead configuration options.\n- Both ItemActivity and BaseListActivity rely on hardcoded ViewPager2 fragment tags (\"f\" + itemId) for getFragment/unbind logic; it may be safer to centralize this tag construction (or encapsulate fragment lookup) in ItemPagerAdapter so future changes to getItemId or adapter behavior don't silently break these lookups.\n\n## Individual Comments\n\n### Comment 1\n\u003clocation\u003e `app/src/main/java/io/github/sheepdestroyer/materialisheep/BaseListActivity.java:539-548` \u003c/location\u003e\n\u003ccode_context\u003e\n+        mAdapter = new ItemPagerAdapter(this, new ItemPagerAdapter.Builder()\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**issue (bug_risk):** The initial ViewPager2 page does not respect the adapter's default view mode (`mDefaultItem`).\n\nPreviously `ItemPagerAdapter.bind` called `viewPager.setCurrentItem(mDefaultItem)`, so the initial page matched `defaultViewMode` (comment vs article). In `bindViewPager` you never set the current item, so `ViewPager2` always starts at position 0 and the initial FAB state can mismatch the user‚Äôs preferred view. You should compute `defaultItem` and call `mViewPager.setCurrentItem(defaultItem, false)` before `updateFabState`.\n\u003c/issue_to_address\u003e\n\n### Comment 2\n\u003clocation\u003e `app/src/main/java/io/github/sheepdestroyer/materialisheep/ItemActivity.java:528-529` \u003c/location\u003e\n\u003ccode_context\u003e\n                 .setShowArticle(true)\n                 .setDefaultViewMode(mStoryViewMode));\n-        mAdapter.bind(mViewPager, mTabLayout, mNavButton, mReplyButton);\n+        mViewPager.setAdapter(mAdapter);\n+        mTabLayoutMediator = new TabLayoutMediator(mTabLayout, mViewPager,\n+                (tab, position) -\u003e tab.setText(mAdapter.getPageTitle(position)));\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**nitpick:** The adapter and offscreen page limit are set twice on the ViewPager2.\n\n`mViewPager.setAdapter(mAdapter)` and `mViewPager.setOffscreenPageLimit(2)` are each called twice in a row, which is redundant. Please set the adapter and offscreen limit only once, before attaching the `TabLayoutMediator`.\n\u003c/issue_to_address\u003e\n\n### Comment 3\n\u003clocation\u003e `app/src/main/java/io/github/sheepdestroyer/materialisheep/LazyLoadFragment.java:44-53` \u003c/location\u003e\n\u003ccode_context\u003e\n-        } else {\n-            mEagerLoad = getArguments() != null \u0026\u0026 getArguments().getBoolean(EXTRA_EAGER_LOAD) ||\n-                    !Preferences.shouldLazyLoad(getActivity());\n+        mViewModel = new ViewModelProvider(this).get(LazyLoadViewModel.class);\n+        if (!mViewModel.isInitialized()) {\n+            mViewModel.setInitialized(true);\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**issue (bug_risk):** `STATE_LOADED` is no longer read and `mLoaded` now persists for the entire ViewModel lifetime, changing reload behavior.\n\nIn the previous implementation, `mLoaded` was reset via `savedInstanceState` (`STATE_LOADED = false`) so reloads were possible after state restoration. With the ViewModel, `STATE_LOADED` is now only written, and `mViewModel.isLoaded()` persists across configuration changes. That means once `load()` runs, `eagerLoad()` will never trigger `load()` again for this ViewModel, which conflicts with the existing comment/behavior. If reload on rotation/process recreation is still desired, either use `STATE_LOADED` when initializing the ViewModel, or remove `STATE_LOADED` and update the comment/behavior to match the new semantics.\n\u003c/issue_to_address\u003e\n\n### Comment 4\n\u003clocation\u003e `app/src/main/java/io/github/sheepdestroyer/materialisheep/BaseListActivity.java:150-154` \u003c/location\u003e\n\u003ccode_context\u003e\n             mTabLayout = (TabLayout) findViewById(R.id.tab_layout);\n             mTabLayout.setVisibility(View.GONE);\n-            mViewPager = (ViewPager) findViewById(R.id.content);\n+            mViewPager = (ViewPager2) findViewById(R.id.content);\n             mViewPager.setVisibility(View.GONE);\n             mReplyButton = (FloatingActionButton) findViewById(R.id.reply_button);\n             mNavButton = (NavFloatingActionButton) findViewById(R.id.navigation_button);\n\u003c/code_context\u003e\n\n\u003cissue_to_address\u003e\n**suggestion (performance):** The ViewPager2 in the multi-pane list layout no longer sets an offscreen page limit, unlike the single-item activity.\n\n`ItemActivity.bindData` still calls `mViewPager.setOffscreenPageLimit(2)`, but `BaseListActivity.bindViewPager` no longer sets an offscreen page limit for the new `ViewPager2` (the old `ViewPager` setup did via `bind`). This will likely cause more fragment recreation and repeated loads when switching tabs in the multi-pane layout. If you still want both fragments kept in memory as before, please set an appropriate offscreen page limit on the multi-pane `ViewPager2` as well.\n\n```suggestion\n            mTabLayout = (TabLayout) findViewById(R.id.tab_layout);\n            mTabLayout.setVisibility(View.GONE);\n            mViewPager = (ViewPager2) findViewById(R.id.content);\n            mViewPager.setOffscreenPageLimit(2);\n            mViewPager.setVisibility(View.GONE);\n            mReplyButton = (FloatingActionButton) findViewById(R.id.reply_button);\n```\n\u003c/issue_to_address\u003e\n~~~\n\n\u003c/details\u003e\n\n***\n\n\u003cdetails\u003e\n\u003csummary\u003eSourcery is free for open source - if you like our reviews please consider sharing them ‚ú®\u003c/summary\u003e\n\n- [X](https://twitter.com/intent/tweet?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [Mastodon](https://mastodon.social/share?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https://sourcery.ai)\n- [Facebook](https://www.facebook.com/sharer/sharer.php?u=https://sourcery.ai)\n\n\u003c/details\u003e\n\n\u003csub\u003e\nHelp me be more useful! Please click üëç or üëé on each comment and I'll use the feedback to improve your reviews.\n\u003c/sub\u003e","commit":{"oid":"33c516489344a4e81a3b428985825ceb5244ac96"},"id":"PRR_kwDOQBDOvc7bG5ml","includesCreatedEdit":false,"reactionGroups":[],"state":"COMMENTED","submittedAt":"2026-01-19T02:06:02Z"}]
